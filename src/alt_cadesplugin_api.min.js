!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.AltCadesPlugin=e(t.$)}(this,function(t){var e,r,n,i=function(t,e){return function(){return t.apply(e,arguments)}},o=[].slice;return t&&!e&&(e=t),n=null,r=function(){function t(t){return null==t&&(t={}),this.set=i(this.set,this),this.get=i(this.get,this),this.getParam=i(this.getParam,this),this.init=i(this.init,this),n?n:(t.timeout&&(this.timeout=t.timeout),this.cadesplugin.JSModuleVersion="2.0",this.cadesplugin.async_spawn=this.asyncSpawn,this.cadesplugin.set=function(t){return function(e){return t.pluginObject=e}}(this),window.cadesplugin=this.cadesplugin,void(n=this))}return t.prototype.checked=!1,t.prototype.cadesplugin={},t.prototype.pluginObject=null,t.prototype.timeout=2e4,t.prototype.isWebkit=function(){return navigator.userAgent.match(/chrome/i)||navigator.userAgent.match(/opera/i)}(),t.prototype.isIE=function(){return"Microsoft Internet Explorer"===navigator.appName||navigator.userAgent.match(/Trident\/./i)}(),t.prototype.asyncSpawn=function(t){var e,r,n,i;return e=function(t,e){var o,c,a;try{a=r[t](e)}catch(c){return o=c,Promise.reject(o)}return a.done?a.value:Promise.resolve(a.value).then(n,i)},r=t(Array.prototype.slice.call(arguments,1)),n=e.bind(e,"next"),i=e.bind(e,"throw"),n()},t.prototype.init=function(){return this.checked?e.when():this.isWebkit?this.initWebkit():this.initNpapi()},t.prototype.initWebkit=function(){var t;return e.getScript("chrome-extension://iifchhfnnmpdbibifmljnfjhpififfog/nmcades_plugin_api.js"),window.postMessage("cadesplugin_echo_request","*"),t=e.Deferred(),e(window).on("message",function(e){return function(e){var r;if("cadesplugin_loaded"===(null!=e&&null!=(r=e.originalEvent)?r.data:void 0))return setTimeout(function(){return cpcsp_chrome_nmcades.check_chrome_plugin(function(e){return function(){return e.checked=!0,t.resolve()}}(this),function(e){return function(r){return e.checked=!0,t.reject(r)}}(this))},0)}}(this)),setTimeout(function(e){return function(){return e.checked?void 0:t.reject("timeout")}}(this),this.timeout),t},t.prototype.initNpapi=function(){var t;return t=e.Deferred(),e(window).on("load",function(e){return function(r){var n;return e.loadNpapiPlugin(),e.checked=!0,n=e.checkNpapiPlugin(),n===!0?t.resolve():t.reject(n)}}(this)),t},t.prototype.loadNpapiPlugin=function(){var t,r;return r=e('<object id="cadesplugin_object" type="application/x-cades" style="visibility:hidden;"></object>'),e("body").append(r),this.pluginObject=r[0],this.isIE?(t=e('<object id="certEnrollClassFactory" classid="clsid:884e2049-217d-11da-b2a4-000e7bbb2b09" style="visibility=hidden"></object>'),e("body").append(t)):void 0},t.prototype.checkNpapiPlugin=function(){var t,e,r,n;try{return this.createObject("CAdESCOM.About"),!0}catch(e){return t=e,r=navigator.mimeTypes["application/x-cades"],r?(n=r.enabledPlugin,n?"plugin_not_loaded_but_object_cannot_create":"error_on_plugin_load"):"plugin_unreachable"}},t.prototype.createObject=function(t){var r,n;if(this.isIE){if(t.match(/X509Enrollment/i))try{return e("certEnrollClassFactory")[0].CreateObject(t)}catch(n){throw r=n,"setup_https_for_x509enrollment"}return new ActiveXObject(t)}return this.pluginObject.CreateObject(t)},t.prototype.getParam=function(t,r){var n,i,o,c,a;if(n=e.Deferred(),this.isWebkit)c="string"==typeof t?this.pluginObject.CreateObjectAsync(t).then(function(t){return function(e){return r?t.extractParam(e,r):e}}(this)):this.extractParam(t,r),c.then(n.resolve,n.reject);else try{"string"==typeof t?(a=this.createObject(t),r&&(a=this.extractParam(a,r))):a=this.extractParam(t,r),n.resolve(a)}catch(o){i=o,n.reject(i.message)}return n},t.prototype.extractParam=function(t,e){if("object"!=typeof e)return t[e];switch(e.args.length){case 0:return t[e.method]();case 1:return t[e.method](e.args[0]);case 2:return t[e.method](e.args[0],e.args[1]);case 3:return t[e.method](e.args[0],e.args[1],e.args[2]);case 4:return t[e.method](e.args[0],e.args[1],e.args[2],e.args[3])}},t.prototype.get=function(){var t,e,r;return e=arguments[0],r=arguments[1],t=3<=arguments.length?o.call(arguments,2):[],this.getParam(e,r).then(function(e){return function(r){return t.length>0?(t.unshift(r),e.get.apply(e,t)):r}}(this))},t.prototype.set=function(t,r,n){var i,o,c,a;if(this.isWebkit)return a={method:"propset_"+r,args:[n]},this.get(t,a);i=e.Deferred();try{t[r]=n,i.resolve()}catch(c){o=c,i.reject(o.message)}return i},t}()});